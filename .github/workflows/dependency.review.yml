# Enterprise Dependency Review Workflow
# Module 3: Production Security Pipeline - Tim Warner
# Demonstrates real-world dependency scanning used by Fortune 500

name: "ğŸ”’ Enterprise Dependency Review"

on:
  pull_request:
    types: [opened, synchronize, reopened]
    paths:
      - "package*.json"
      - "yarn.lock"
      - "pnpm-lock.yaml"

# Enterprise security permissions - principle of least privilege
permissions:
  contents: read
  pull-requests: write
  security-events: write
  actions: read

jobs:
  dependency-review:
    name: "ğŸ›¡ï¸ Dependency Security Scan"
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: "ğŸ” Enterprise Dependency Review"
        uses: actions/dependency-review-action@v4
        with:
          fail-on-severity: moderate
          allow-licenses: MIT, Apache-2.0, BSD-3-Clause, ISC
          deny-licenses: GPL-2.0, GPL-3.0
          vulnerability-check: true
          license-check: true
          comment-summary-in-pr: true
          retry-on-snapshot-warnings: true
          warn-only: false

      - name: "ğŸ“Š Security Report"
        if: always()
        run: |
          echo "ğŸ”’ Enterprise Security Scan Complete"
          echo "ğŸ“‹ Vulnerability assessment finished"
          echo "âš–ï¸ License compliance checked"
          echo "ğŸ“Š Results available in PR comments"

# Enterprise Features Demonstrated:
# âœ… Granular permissions (security-first)
# âœ… Advanced vulnerability filtering
# âœ… License compliance checking
# âœ… Automated PR security comments
# âœ… Multi-trigger event handling
# âœ… File path filtering for efficiency
